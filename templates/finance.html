<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Factory — Финансовый учет</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <style>
        .stat-card { background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%); backdrop-filter: blur(10px); }
        .spinner { border: 2px solid #f3f3f3; border-top: 2px solid #3B82F6; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .chart-container { position: relative; }
        .loading-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.8); display: flex; align-items: center; justify-content: center; z-index: 10; }
        .sidebar { 
            width: 280px; 
            transition: all 0.3s ease;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        .sidebar::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: transparent;
        }
        
        .sidebar {
            scrollbar-width: none;
        }
        .sidebar.sidebar-hidden { 
            transform: translateX(-100%); 
        }
        .main-content { 
            margin-left: 280px; 
            transition: margin-left 0.3s ease; 
        }
        .main-content.expanded { 
            margin-left: 0; 
        }
        .sidebar-item { transition: all 0.2s ease; }
        .sidebar-item:hover { background-color: #f3f4f6; transform: translateX(4px); }
        .sidebar-item.active { background-color: #dbeafe; color: #1d4ed8; border-right: 3px solid #3b82f6; }
        .sidebar-item.active i { color: #1d4ed8; }
        .sidebar-toggle { transition: transform 0.3s ease; }
        .sidebar-toggle.rotated { transform: rotate(180deg); }
        
        .transaction-row { transition: all 0.2s ease; }
        .transaction-row:hover { background-color: #f9fafb; transform: translateX(2px); }
        
        .profit { color: #059669; }
        .loss { color: #dc2626; }
        .neutral { color: #6b7280; }
        
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .main-content { margin-left: 0; }
            .sidebar.mobile-open { transform: translateX(0); }
        }
        
        /* Скрытие модальных окон по умолчанию */
        [x-cloak] { display: none !important; }
        
        /* Дополнительная защита для модальных окон */
        .modal-hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
<div x-data="financialAccounting()" x-init="init()">
        <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 fixed top-0 left-0 right-0 z-40" :class="sidebarOpen ? 'lg:left-72' : 'lg:left-0'">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <!-- Sidebar Toggle Button -->
                    <button @click="toggleSidebar()" class="mr-4 p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <i data-lucide="menu" class="w-5 h-5 text-gray-600 sidebar-toggle" :class="sidebarOpen ? 'rotated' : ''"></i>
                    </button>
                    
                    <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center mr-3">
                        <span class="text-white font-bold text-xl">₽</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">Финансовый учет</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <span class="text-sm text-gray-600">Пользователь:</span>
                        <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-medium" x-text="(userName || 'П').charAt(0).toUpperCase()"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

        <!-- Sidebar -->
    <aside class="sidebar fixed top-0 left-0 h-full bg-white border-r border-gray-200 z-50" :class="sidebarOpen ? '' : 'sidebar-hidden'">
        <div class="p-6">
            <!-- Logo Section -->
            <div class="flex items-center mb-8">
                <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center mr-3">
                    <span class="text-white font-bold text-xl">₽</span>
                </div>
                <div>
                    <h2 class="text-lg font-bold text-gray-900">Финансы</h2>
                    <p class="text-sm text-gray-500">Управление деньгами</p>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="space-y-2">
                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Основное меню</h3>
                
                <a href="/dashboard/" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="home" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Главная</span>
                </a>

                <a href="/financial/" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 active">
                    <i data-lucide="dollar-sign" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Финансы</span>
                </a>

                <a href="/orders/" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="clipboard-list" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Заказы</span>
                </a>

                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 mt-6">Финансовые разделы</h3>

                <a href="#overview" @click.prevent="scrollToSection('overview')" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="bar-chart-3" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Обзор</span>
                </a>

                <a href="#cash-flow" @click.prevent="scrollToSection('cash-flow')" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="trending-up" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Движение денег</span>
                </a>

                <a href="#income-expenses" @click.prevent="scrollToSection('income-expenses')" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="pie-chart" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Доходы и расходы</span>
                </a>

                <a href="#reports" @click.prevent="scrollToSection('reports')" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="file-text" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Отчеты</span>
                </a>

                <a href="#analytics" @click.prevent="scrollToSection('analytics')" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50">
                    <i data-lucide="activity" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Аналитика</span>
                </a>

                <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3 mt-6">Быстрые действия</h3>

                <button @click="showAddTransactionModal = true" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 w-full text-left">
                    <i data-lucide="plus-circle" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Добавить транзакцию</span>
                </button>

                <button @click="showAddCategoryModal = true" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 w-full text-left">
                    <i data-lucide="folder-plus" class="w-5 h-5 text-gray-500"></i>
                    <span class="font-medium">Новая категория</span>
                </button>
            </nav>

            <!-- Quick Stats in Sidebar -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg">
                <h4 class="text-sm font-semibold text-gray-700 mb-3">Финансовый обзор</h4>
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Баланс:</span>
                        <span class="font-medium" :class="overview.balance >= 0 ? 'text-green-600' : 'text-red-600'" x-text="formatCurrency(overview.balance || 0)"></span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Доходы:</span>
                        <span class="font-medium text-green-600" x-text="formatCurrency(overview.totalIncome || 0)"></span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Расходы:</span>
                        <span class="font-medium text-red-600" x-text="formatCurrency(overview.totalExpenses || 0)"></span>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content pt-16" :class="sidebarOpen ? '' : 'expanded'">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Page Title -->
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-900">Финансовый учет</h2>
                <p class="text-gray-600 mt-2">Полный контроль над финансами предприятия</p>
            </div>

            <!-- Overview Section -->
            <section id="overview" class="mb-12">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Финансовый обзор</h3>
                    <p class="text-gray-600">Ключевые показатели и текущее состояние</p>
                </div>

                <!-- Key Metrics Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Total Balance -->
                    <div class="stat-card rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Общий баланс</p>
                                <p class="text-2xl font-bold" :class="overview.balance >= 0 ? 'text-green-600' : 'text-red-600'" x-text="formatCurrency(overview.balance || 0)"></p>
                                <p class="text-sm text-gray-500">Текущий остаток</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="wallet" class="w-6 h-6 text-blue-600"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Total Income -->
                    <div class="stat-card rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Общий доход</p>
                                <p class="text-2xl font-bold text-green-600" x-text="formatCurrency(overview.totalIncome || 0)"></p>
                                <p class="text-sm text-gray-500">За период</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Total Expenses -->
                    <div class="stat-card rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Общие расходы</p>
                                <p class="text-2xl font-bold text-red-600" x-text="formatCurrency(overview.totalExpenses || 0)"></p>
                                <p class="text-sm text-gray-500">За период</p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-6 h-6 text-red-600"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Net Profit -->
                    <div class="stat-card rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Чистая прибыль</p>
                                <p class="text-2xl font-bold" :class="overview.netProfit >= 0 ? 'text-green-600' : 'text-red-600'" x-text="formatCurrency(overview.netProfit || 0)"></p>
                                <p class="text-sm text-gray-500">Доход - Расходы</p>
                            </div>
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i data-lucide="target" class="w-6 h-6 text-purple-600"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Period Selector -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-8">
                    <div class="flex flex-wrap items-center justify-between gap-4">
                        <div class="flex items-center space-x-4">
                            <label class="text-sm font-medium text-gray-700">Период:</label>
                            <select x-model="selectedPeriod" @change="loadFinancialData()" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="today">Сегодня</option>
                                <option value="week">Неделя</option>
                                <option value="month" selected>Месяц</option>
                                <option value="quarter">Квартал</option>
                                <option value="year">Год</option>
                                <option value="custom">Произвольный</option>
                            </select>
                        </div>
                        
                        <div x-show="selectedPeriod === 'custom'" class="flex items-center space-x-4">
                            <input type="date" x-model="customStartDate" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <span class="text-gray-500">—</span>
                            <input type="date" x-model="customEndDate" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <button @click="loadFinancialData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">Применить</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Cash Flow Section -->
            <section id="cash-flow" class="mb-12">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Движение денег</h3>
                    <p class="text-gray-600">Анализ денежных потоков и транзакций</p>
                </div>

                <!-- Cash Flow Chart -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold text-gray-900">График движения денег</h4>
                        <div class="flex space-x-2">
                            <select x-model="cashFlowMetric" @change="updateCashFlowChart()" class="border border-gray-300 rounded-lg px-3 py-1 text-sm">
                                <option value="balance">Баланс</option>
                                <option value="income">Доходы</option>
                                <option value="expenses">Расходы</option>
                                <option value="net">Чистый поток</option>
                            </select>
                        </div>
                    </div>
                    <div class="chart-container h-80">
                        <div x-show="loading" class="loading-overlay">
                            <div class="flex items-center space-x-2">
                                <div class="spinner"></div>
                                <span class="text-gray-600">Загрузка...</span>
                            </div>
                        </div>
                        <canvas id="cashFlowChart"></canvas>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold text-gray-900">Последние транзакции</h4>
                        <button @click="showAddTransactionModal = true" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700 flex items-center space-x-2">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            <span>Добавить</span>
                        </button>
                    </div>
                    
                    <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Описание</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Категория</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тип</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сумма</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Баланс</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="transaction in recentTransactions" :key="transaction.id">
                                    <tr class="transaction-row hover:bg-gray-50">
                                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900" x-text="formatDate(transaction.date)"></td>
                                        <td class="px-3 py-3 whitespace-nowrap">
                                            <span class="text-sm font-medium text-gray-900" x-text="transaction.description"></span>
                                        </td>
                                        <td class="px-3 py-3 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800" x-text="transaction.category"></span>
                                        </td>
                                        <td class="px-3 py-3 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full" 
                                                  :class="transaction.type === 'income' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'"
                                                  x-text="transaction.type === 'income' ? 'Доход' : 'Расход'"></span>
                                        </td>
                                        <td class="px-3 py-3 whitespace-nowrap">
                                            <span class="text-sm font-medium" :class="transaction.type === 'income' ? 'profit' : 'loss'" x-text="formatCurrency(transaction.amount)"></span>
                                        </td>
                                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900" x-text="formatCurrency(transaction.balance)"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        <div x-show="recentTransactions.length === 0" class="text-center py-8 text-gray-500">
                            <p class="text-sm">Нет транзакций для отображения</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Income & Expenses Section -->
            <section id="income-expenses" class="mb-12">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Доходы и расходы</h3>
                    <p class="text-gray-600">Детальный анализ по категориям</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Income by Category Chart -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Доходы по категориям</h4>
                        <div class="chart-container h-64">
                            <canvas id="incomeChart"></canvas>
                        </div>
                    </div>

                    <!-- Expenses by Category Chart -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Расходы по категориям</h4>
                        <div class="chart-container h-64">
                            <canvas id="expensesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Category Breakdown -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Детализация по категориям</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="category in categoryBreakdown" :key="category.name">
                            <div class="p-4 border border-gray-200 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <h5 class="font-medium text-gray-900" x-text="category.name"></h5>
                                    <span class="text-sm text-gray-500" x-text="category.count + ' транзакций'"></span>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Доходы:</span>
                                        <span class="font-medium profit" x-text="formatCurrency(category.income || 0)"></span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Расходы:</span>
                                        <span class="font-medium loss" x-text="formatCurrency(category.expenses || 0)"></span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Итого:</span>
                                        <span class="font-medium" :class="(category.income - category.expenses) >= 0 ? 'profit' : 'loss'" x-text="formatCurrency((category.income || 0) - (category.expenses || 0))"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="mb-12">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Финансовые отчеты</h3>
                    <p class="text-gray-600">Генерация и экспорт отчетов</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Profit & Loss Report -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="file-text" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Отчет о прибылях и убытках</h4>
                                <p class="text-sm text-gray-500">P&L отчет</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Детальный анализ доходов, расходов и прибыли за выбранный период</p>
                        <button @click="generateReport('profit-loss')" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">Сгенерировать</button>
                    </div>

                    <!-- Cash Flow Report -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="trending-up" class="w-6 h-6 text-green-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Отчет о движении денег</h4>
                                <p class="text-sm text-gray-500">Cash Flow</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Анализ денежных потоков и источников финансирования</p>
                        <button @click="generateReport('cash-flow')" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">Сгенерировать</button>
                    </div>

                    <!-- Balance Sheet Report -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="scale" class="w-6 h-6 text-purple-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Балансовый отчет</h4>
                                <p class="text-sm text-gray-500">Balance Sheet</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Структура активов, обязательств и капитала</p>
                        <button @click="generateReport('balance-sheet')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700">Сгенерировать</button>
                    </div>
                </div>

                <!-- Report History -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">История отчетов</h4>
                    <div class="overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тип отчета</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Период</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="report in reportHistory" :key="report.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900" x-text="formatDate(report.date)"></td>
                                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900" x-text="report.type"></td>
                                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900" x-text="report.period"></td>
                                        <td class="px-3 py-3 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full" 
                                                  :class="report.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'"
                                                  x-text="report.status === 'completed' ? 'Готов' : 'В процессе'"></span>
                                        </td>
                                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-900">
                                            <button x-show="report.status === 'completed'" @click="downloadReport(report.id)" class="text-blue-600 hover:text-blue-800">Скачать</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics" class="mb-12">
                <div class="mb-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Финансовая аналитика</h3>
                    <p class="text-gray-600">Углубленный анализ и прогнозирование</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Financial Ratios -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Ключевые финансовые показатели</h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Рентабельность продаж</span>
                                <span class="text-sm font-medium" x-text="(analytics.profitMargin || 0).toFixed(2) + '%'"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Коэффициент текущей ликвидности</span>
                                <span class="text-sm font-medium" x-text="(analytics.currentRatio || 0).toFixed(2)"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Оборачиваемость активов</span>
                                <span class="text-sm font-medium" x-text="(analytics.assetTurnover || 0).toFixed(2)"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Долговая нагрузка</span>
                                <span class="text-sm font-medium" x-text="(analytics.debtRatio || 0).toFixed(2) + '%'"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Trend Analysis -->
                    <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Анализ трендов</h4>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Тренд доходов</span>
                                <span class="text-sm font-medium" :class="analytics.incomeTrend >= 0 ? 'profit' : 'loss'" x-text="(analytics.incomeTrend || 0).toFixed(1) + '%'"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Тренд расходов</span>
                                <span class="text-sm font-medium" :class="analytics.expenseTrend <= 0 ? 'profit' : 'loss'" x-text="(analytics.expenseTrend || 0).toFixed(1) + '%'"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Тренд прибыли</span>
                                <span class="text-sm font-medium" :class="analytics.profitTrend >= 0 ? 'profit' : 'loss'" x-text="(analytics.profitTrend || 0).toFixed(1) + '%'"></span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-600">Прогноз на следующий месяц</span>
                                <span class="text-sm font-medium" :class="analytics.nextMonthForecast >= 0 ? 'profit' : 'loss'" x-text="formatCurrency(analytics.nextMonthForecast || 0)"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Forecasting Chart -->
                <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Прогнозирование</h4>
                    <div class="chart-container h-80">
                        <canvas id="forecastChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Transaction Modal -->
    <div x-show="showAddTransactionModal" x-cloak class="modal-hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Добавить транзакцию</h3>
                <form @submit.prevent="addTransaction()">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Тип</label>
                            <select x-model="newTransaction.type" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="income">Доход</option>
                                <option value="expense">Расход</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Сумма</label>
                            <input type="number" x-model="newTransaction.amount" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Описание</label>
                            <input type="text" x-model="newTransaction.description" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Категория</label>
                            <select x-model="newTransaction.category" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                <template x-for="category in categories" :key="category">
                                    <option :value="category" x-text="category"></option>
                                </template>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Дата</label>
                            <input type="date" x-model="newTransaction.date" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" @click="showAddTransactionModal = false" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Отмена</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">Добавить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div x-show="showAddCategoryModal" x-cloak class="modal-hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Добавить категорию</h3>
                <form @submit.prevent="addCategory()">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Название категории</label>
                            <input type="text" x-model="newCategory.name" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Тип</label>
                            <select x-model="newCategory.type" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2">
                                <option value="income">Доход</option>
                                <option value="expense">Расход</option>
                                <option value="both">Оба</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Описание</label>
                            <textarea x-model="newCategory.description" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" @click="showAddCategoryModal = false" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200">Отмена</button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700">Добавить</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
    function financialAccounting() {
        return {
            overview: {},
            recentTransactions: [],
            categoryBreakdown: [],
            reportHistory: [],
            analytics: {},
            categories: ['Продажи', 'Услуги', 'Материалы', 'Зарплата', 'Аренда', 'Коммунальные услуги', 'Оборудование', 'Другое'],
            selectedPeriod: 'month',
            customStartDate: '',
            customEndDate: '',
            cashFlowMetric: 'balance',
            showAddTransactionModal: false,
            showAddCategoryModal: false,
            newTransaction: {
                type: 'income',
                amount: '',
                description: '',
                category: 'Продажи',
                date: new Date().toISOString().split('T')[0]
            },
            newCategory: {
                name: '',
                type: 'both',
                description: ''
            },
            loading: false,
            cashFlowChart: null,
            incomeChart: null,
            expensesChart: null,
            forecastChart: null,
            sidebarOpen: true,

            async init() {
                // Убеждаемся, что модальные окна скрыты при инициализации
                this.showAddTransactionModal = false;
                this.showAddCategoryModal = false;
                
                await this.loadFinancialData();
                await this.initCharts();
                lucide.createIcons();
                this.$nextTick(() => {
                    lucide.createIcons();
                    if (this.sidebarOpen) {
                        document.querySelector('.sidebar').classList.remove('sidebar-hidden');
                        document.querySelector('.main-content').classList.remove('expanded');
                    }
                    if (window.innerWidth < 1024) {
                        this.sidebarOpen = false;
                        document.querySelector('.sidebar').classList.add('sidebar-hidden');
                        document.querySelector('.main-content').classList.add('expanded');
                    }
                });
            },

            toggleSidebar() {
                this.sidebarOpen = !this.sidebarOpen;
                this.$nextTick(() => {
                    if (this.sidebarOpen) {
                        document.querySelector('.sidebar').classList.remove('sidebar-hidden');
                        document.querySelector('.main-content').classList.remove('expanded');
                    } else {
                        document.querySelector('.sidebar').classList.add('sidebar-hidden');
                        document.querySelector('.main-content').classList.add('expanded');
                    }
                });
            },

            scrollToSection(sectionId) {
                const element = document.getElementById(sectionId);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                }
            },

            async loadFinancialData() {
                try {
                    this.loading = true;
                    
                    // Загружаем основную статистику
                    const overviewResponse = await fetch('/financial/api/overview/', {
                        headers: { 'X-Requested-With': 'XMLHttpRequest', 'Content-Type': 'application/json' } 
                    });
                    if (overviewResponse.ok) {
                        this.overview = await overviewResponse.json();
                    } else {
                        // Моковые данные для демонстрации
                        this.overview = {
                            balance: 1250000,
                            totalIncome: 2500000,
                            totalExpenses: 1250000,
                            netProfit: 1250000
                        };
                    }

                    // Загружаем транзакции
                    await this.loadTransactions();
                    
                    // Загружаем аналитику
                    await this.loadAnalytics();
                    
                    // Загружаем историю отчетов
                    await this.loadReportHistory();

                } catch (e) { 
                    console.error('Ошибка загрузки финансовых данных:', e);
                    // Моковые данные при ошибке
                    this.overview = {
                        balance: 1250000,
                        totalIncome: 2500000,
                        totalExpenses: 1250000,
                        netProfit: 1250000
                    };
                } finally { 
                    this.loading = false; 
                }
            },

            async loadTransactions() {
                try {
                    const response = await fetch('/financial/api/transactions/');
                    if (response.ok) {
                        const data = await response.json();
                        this.recentTransactions = data.results || data;
                    } else {
                        // Моковые данные
                        this.recentTransactions = [
                            {
                                id: 1,
                                date: '2024-01-15',
                                description: 'Продажа продукции',
                                category: 'Продажи',
                                type: 'income',
                                amount: 150000,
                                balance: 1400000
                            },
                            {
                                id: 2,
                                date: '2024-01-14',
                                description: 'Закупка материалов',
                                category: 'Материалы',
                                type: 'expense',
                                amount: 75000,
                                balance: 1250000
                            },
                            {
                                id: 3,
                                date: '2024-01-13',
                                description: 'Оплата аренды',
                                category: 'Аренда',
                                type: 'expense',
                                amount: 50000,
                                balance: 1325000
                            }
                        ];
                    }
                } catch (e) {
                    console.error('Ошибка загрузки транзакций:', e);
                }
            },

            async loadAnalytics() {
                try {
                    const response = await fetch('/financial/api/analytics/');
                    if (response.ok) {
                        const data = await response.json();
                        this.analytics = data;
                    } else {
                        // Моковые данные
                        this.analytics = {
                            profitMargin: 15.5,
                            currentRatio: 2.1,
                            assetTurnover: 1.8,
                            debtRatio: 25.3,
                            incomeTrend: 12.5,
                            expenseTrend: -5.2,
                            profitTrend: 18.7,
                            nextMonthForecast: 1350000
                        };
                    }
                } catch (e) {
                    console.error('Ошибка загрузки аналитики:', e);
                }
            },

            async loadReportHistory() {
                try {
                    const response = await fetch('/financial/api/reports/');
                    if (response.ok) {
                        const data = await response.json();
                        this.reportHistory = data.results || data;
                    } else {
                        // Моковые данные
                        this.reportHistory = [
                            {
                                id: 1,
                                date: '2024-01-15',
                                type: 'Отчет о прибылях и убытках',
                                period: 'Декабрь 2024',
                                status: 'completed'
                            },
                            {
                                id: 2,
                                date: '2024-01-10',
                                type: 'Отчет о движении денег',
                                period: 'Декабрь 2024',
                                status: 'completed'
                            }
                        ];
                    }
                } catch (e) {
                    console.error('Ошибка загрузки истории отчетов:', e);
                }
            },

            async initCharts() {
                await this.initCashFlowChart();
                await this.initIncomeChart();
                await this.initExpensesChart();
                await this.initForecastChart();
            },

            async initCashFlowChart() {
                const ctx = document.getElementById('cashFlowChart');
                if (!ctx) return;

                if (this.cashFlowChart) this.cashFlowChart.destroy();

                this.cashFlowChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'],
                        datasets: [{
                            label: 'Баланс',
                            data: [1000000, 1100000, 1200000, 1150000, 1250000, 1300000],
                            borderColor: '#3B82F6',
                            backgroundColor: '#3B82F622',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff'
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                                ticks: { color: '#6B7280' }
                            },
                            y: {
                                grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            },

            async initIncomeChart() {
                const ctx = document.getElementById('incomeChart');
                if (!ctx) return;

                if (this.incomeChart) this.incomeChart.destroy();

                this.incomeChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Продажи', 'Услуги', 'Другое'],
                        datasets: [{
                            data: [70, 20, 10],
                            backgroundColor: ['#10B981', '#3B82F6', '#F59E0B'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            },

            async initExpensesChart() {
                const ctx = document.getElementById('expensesChart');
                if (!ctx) return;

                if (this.expensesChart) this.expensesChart.destroy();

                this.expensesChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Материалы', 'Зарплата', 'Аренда', 'Оборудование'],
                        datasets: [{
                            data: [40, 30, 20, 10],
                            backgroundColor: ['#EF4444', '#8B5CF6', '#F59E0B', '#6B7280'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            },

            async initForecastChart() {
                const ctx = document.getElementById('forecastChart');
                if (!ctx) return;

                if (this.forecastChart) this.forecastChart.destroy();

                this.forecastChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг'],
                        datasets: [{
                            label: 'Фактические данные',
                            data: [1000000, 1100000, 1200000, 1150000, 1250000, 1300000, null, null],
                            borderColor: '#3B82F6',
                            backgroundColor: '#3B82F622',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: false
                        }, {
                            label: 'Прогноз',
                            data: [null, null, null, null, null, 1300000, 1350000, 1400000],
                            borderColor: '#10B981',
                            backgroundColor: '#10B98122',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff'
                            }
                        },
                        scales: {
                            x: {
                                grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                                ticks: { color: '#6B7280' }
                            },
                            y: {
                                grid: { display: true, color: 'rgba(0,0,0,0.05)' },
                                ticks: { color: '#6B7280' }
                            }
                        }
                    }
                });
            },

            updateCashFlowChart() {
                this.initCashFlowChart();
            },

            async addTransaction() {
                try {
                    const response = await fetch('/financial/api/transactions/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCSRFToken()
                        },
                        body: JSON.stringify(this.newTransaction)
                    });

                    if (response.ok) {
                        await this.loadFinancialData();
                        this.showAddTransactionModal = false;
                        this.resetNewTransaction();
                    }
                } catch (e) {
                    console.error('Ошибка добавления транзакции:', e);
                }
            },

            async addCategory() {
                try {
                    const response = await fetch('/financial/api/categories/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCSRFToken()
                        },
                        body: JSON.stringify(this.newCategory)
                    });

                    if (response.ok) {
                        await this.loadFinancialData();
                        this.showAddCategoryModal = false;
                        this.resetNewCategory();
                    }
                } catch (e) {
                    console.error('Ошибка добавления категории:', e);
                }
            },

            resetNewTransaction() {
                this.newTransaction = {
                    type: 'income',
                    amount: '',
                    description: '',
                    category: 'Продажи',
                    date: new Date().toISOString().split('T')[0]
                };
            },

            resetNewCategory() {
                this.newCategory = {
                    name: '',
                    type: 'both',
                    description: ''
                };
            },

            async generateReport(reportType) {
                try {
                    this.loading = true;
                    const response = await fetch(`/financial/api/reports/generate/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': this.getCSRFToken()
                        },
                        body: JSON.stringify({
                            type: reportType,
                            period: this.selectedPeriod,
                            startDate: this.customStartDate,
                            endDate: this.customEndDate
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('Отчет сгенерирован:', data);
                        await this.loadReportHistory();
                    }
                } catch (e) {
                    console.error('Ошибка генерации отчета:', e);
                } finally {
                    this.loading = false;
                }
            },

            async downloadReport(reportId) {
                try {
                    const response = await fetch(`/financial/api/reports/${reportId}/download/`);
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `report_${reportId}.pdf`;
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        document.body.removeChild(a);
                    }
                } catch (e) {
                    console.error('Ошибка скачивания отчета:', e);
                }
            },

            getCSRFToken() {
                const name = 'csrftoken';
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            },

            formatCurrency(amount) {
                return new Intl.NumberFormat('ru-RU', {
                    style: 'currency',
                    currency: 'RUB',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            },

            formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: '2-digit'
                });
            }
        }
    }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
            
            // Дополнительная защита: скрываем модальные окна при загрузке
            const modals = document.querySelectorAll('[x-show]');
            modals.forEach(modal => {
                if (modal.getAttribute('x-show') && modal.getAttribute('x-show').includes('Modal')) {
                    modal.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>