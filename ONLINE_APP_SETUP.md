# Быстрая настройка приложения "Онлайн пользователи"

## Что уже сделано

✅ Приложение создано и настроено  
✅ Модели и миграции готовы  
✅ Views с проверкой staff доступа  
✅ Middleware для отслеживания активности  
✅ Admin интерфейс настроен  
✅ Шаблоны созданы (десктоп + мобильная версия)  
✅ API endpoints готовы  
✅ Команды управления созданы  
✅ Тесты написаны  
✅ Приложение добавлено в INSTALLED_APPS  
✅ Middleware добавлен в настройки  

## Следующие шаги

### 1. Выполните миграции

```bash
python manage.py makemigrations online
python manage.py migrate
```

### 2. Инициализируйте активность существующих пользователей

```bash
python manage.py init_user_activity
```

### 3. Создайте суперпользователя (если еще нет)

```bash
python manage.py createsuperuser
```

### 4. Запустите сервер

```bash
python manage.py runserver
```

### 5. Проверьте работу

- Войдите как staff пользователь
- Перейдите по адресу: `http://localhost:8000/online/`
- Должна отобразиться страница с онлайн пользователями

## Тестирование

### Запуск тестов

```bash
python manage.py test apps.online
```

### Тестовый скрипт

```bash
python test_online_app.py
```

## Основные URL

- `/online/` - Список онлайн пользователей
- `/online/api/` - API для получения данных
- `/online/user/<id>/` - Детали активности пользователя

## Команды управления

```bash
# Очистка старых записей
python manage.py cleanup_old_activity --days 30

# Инициализация активности
python manage.py init_user_activity --force
```

## Особенности

- **Доступ только для staff** - обычные пользователи не могут видеть страницу
- **Автообновление** - данные обновляются каждые 30 секунд
- **Middleware** - автоматически отслеживает активность при каждом запросе
- **Мобильная версия** - адаптивные шаблоны для мобильных устройств
- **API** - JSON endpoints для интеграции с другими системами

## Безопасность

- Все views защищены декораторами `@login_required` и `@user_passes_test`
- Проверка `is_staff` на уровне views и API
- Middleware безопасно обрабатывает ошибки

## Мониторинг

Приложение автоматически:
- Создает записи активности для новых пользователей
- Обновляет время последней активности при каждом запросе
- Отмечает пользователей как онлайн/офлайн
- Предоставляет статистику в реальном времени 