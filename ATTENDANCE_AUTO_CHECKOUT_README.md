# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ 18:00 —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –≤ –º–æ–±–∏–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö.

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ —É—Ö–æ–¥–∞
- **–í—Ä–µ–º—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è**: –ü–æ—Å–ª–µ 18:00 (18:00)
- **–õ–æ–≥–∏–∫–∞**: –í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏—à–ª–∏ –Ω–∞ —Ä–∞–±–æ—Ç—É, –Ω–æ –Ω–µ –æ—Ç–º–µ—Ç–∏–ª–∏ —É—Ö–æ–¥, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —É—à–µ–¥—à–∏–µ
- **–°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞**:
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Celery Beat (–∫–∞–∂–¥—ã–π —á–∞—Å)
  - –í—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ API endpoint
  - –ß–µ—Ä–µ–∑ management command
  - –ß–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –≤ –º–æ–±–∏–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### 2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è
- **–°—Ç–∞—Ç—É—Å—ã**:
  - üü¢ **–ù–∞ —Ä–∞–±–æ—Ç–µ** (present) - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ø—Ä–∏—à–µ–ª, –Ω–æ –Ω–µ —É—à–µ–ª
  - ‚ö™ **–£—à–µ–ª** (checked_out) - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –æ—Ç–º–µ—Ç–∏–ª —É—Ö–æ–¥
  - üî¥ **–ù–µ –ø—Ä–∏—à–µ–ª** (absent) - —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ –æ—Ç–º–µ—á–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è

### 3. –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- –¶–≤–µ—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥ –∏–º–µ–Ω–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏ —É—Ö–æ–¥–∞ –≤ header

## API Endpoints

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
```
GET /attendance/api/employee-status/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "date": "2024-01-15",
  "current_time": "2024-01-15T14:30:00Z",
  "employees": [
    {
      "id": 1,
      "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
      "status": "present",
      "check_in_time": "2024-01-15T09:00:00Z",
      "check_out_time": null,
      "is_late": false,
      "penalty_amount": 0.0
    }
  ]
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ —Ü–µ—Ö—É
```
GET /attendance/api/employee-status-by-workshop/?workshop_id=1
```

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ —É—Ö–æ–¥–∞
```
POST /attendance/api/auto-checkout/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ—á–µ–Ω —É—Ö–æ–¥ –¥–ª—è 5 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
  "checked_out_count": 5,
  "checkout_time": "2024-01-15T18:00:00Z"
}
```

## Management Commands

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ —É—Ö–æ–¥–∞
```bash
python manage.py auto_checkout_after_6pm
```

**–§–ª–∞–≥–∏:**
- `--force` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```bash
# –û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ 18:00)
python manage.py auto_checkout_after_6pm

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
python manage.py auto_checkout_after_6pm --force
```

## Celery Tasks

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
- `auto_checkout_after_6pm` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –∏ –æ—Ç–º–µ—á–∞–µ—Ç —É—Ö–æ–¥
- `cleanup_old_attendance_records` - –æ—á–∏—â–∞–µ—Ç –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á
```python
from apps.attendance.tasks import auto_checkout_after_6pm

# –ó–∞–ø—É—Å–∫ –∑–∞–¥–∞—á–∏
result = auto_checkout_after_6pm.delay()
print(result.get())
```

## –ú–æ–±–∏–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —à–∞–±–ª–æ–Ω–∞—Ö:
1. **employees_mobile_master.html** - –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤ —Ü–µ—Ö–æ–≤
2. **employees_mobile.html** - –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
- –¶–≤–µ—Ç–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞—Ö
- –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥ –∏–º–µ–Ω–∞–º–∏
- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏ —É—Ö–æ–¥–∞ –≤ header

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```bash
python test_auto_checkout.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏ —É—Ö–æ–¥–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
```bash
# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
curl -X GET "http://localhost:8000/attendance/api/employee-status/" \
  -H "Authorization: Bearer YOUR_TOKEN"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–º–µ—Ç–∫–∞ —É—Ö–æ–¥–∞
curl -X POST "http://localhost:8000/attendance/api/auto-checkout/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "X-CSRFToken: YOUR_CSRF_TOKEN"
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –í—Ä–µ–º—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–º–µ—Ç–∫–∏
–ò–∑–º–µ–Ω–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–∞–π–ª–∞—Ö:
- `apps/attendance/views.py` - —Ñ—É–Ω–∫—Ü–∏—è `auto_checkout_after_6pm`
- `apps/attendance/tasks.py` - –∑–∞–¥–∞—á–∞ `auto_checkout_after_6pm`
- `apps/attendance/management/commands/auto_checkout_after_6pm.py`

### 2. –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ `core/celery.py`:
```python
'auto-checkout-after-6pm': {
    'task': 'apps.attendance.tasks.auto_checkout_after_6pm',
    'schedule': 3600.0,  # –ö–∞–∂–¥—ã–π —á–∞—Å
},
```

### 3. –®—Ç—Ä–∞—Ñ—ã –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ `apps/attendance/models.py`:
```python
def calculate_penalty(self):
    work_start_time = time(9, 0)  # –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
    # –®—Ç—Ä–∞—Ñ 500 —Å–æ–º–æ–≤ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ
    self.penalty_amount = 500.00
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏
–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ Celery –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á:
```bash
celery -A core worker -l info
celery -A core beat -l info
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
API endpoint `/attendance/api/overview/` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å–µ–≥–æ–¥–Ω—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—à–µ–¥—à–∏—Ö
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–æ–∑–¥–∞–Ω–∏–π
- –û–±—â–∞—è —Å—É–º–º–∞ —à—Ç—Ä–∞—Ñ–æ–≤

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ API endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- CSRF –∑–∞—â–∏—Ç–∞ –¥–ª—è POST –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Ç–º–µ—Ç–∫–∏ —É—Ö–æ–¥–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ Celery Beat
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Celery
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç—É—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API endpoint `/attendance/api/employee-status/`
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSRF —Ç–æ–∫–µ–Ω
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 