<!DOCTYPE html>
<html lang="ru" style="margin:0; padding:0;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/icon-192x192.png">
    <link rel="shortcut icon" href="/static/icons/icon-192x192.png">
    <title>Smart Factory — Техническое обслуживание</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" media="all">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest" defer></script>
    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        html, body { margin: 0 !important; padding: 0 !important; }
        .maintenance-card { 
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%); 
            backdrop-filter: blur(10px); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .timer-card { 
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            box-shadow: 0 8px 32px rgba(59,130,246,0.3);
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform-origin: 50% 50%;
        }
        .floating-icon {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50" style="font-family: system-ui, -apple-system, sans-serif; margin:0; padding:0;">
<div x-data="maintenancePage()" x-init="init()" class="pb-16">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-30 bg-white/90 backdrop-blur border-b border-gray-200 flex items-center justify-between h-14 px-4">
        <div class="flex items-center gap-2">
            <div class="w-9 h-9 bg-blue-600 rounded-lg flex items-center justify-center">
                <span class="text-white font-bold text-lg">S</span>
            </div>
            <span class="font-semibold text-lg text-gray-900">Smart Factory</span>
        </div>
        <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-orange-500 rounded-full flex items-center justify-center">
                <i data-lucide="wrench" class="w-3 h-3 text-white"></i>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-16 px-4 max-w-md mx-auto">
        <!-- Maintenance Status -->
        <div class="text-center mb-8 mt-4">
            <div class="floating-icon mb-4">
                <!-- <div class="w-24 h-24 bg-orange-500 rounded-full flex items-center justify-center mx-auto shadow-lg">
                    <i data-lucide="wrench" class="w-12 h-12 text-white"></i>
                </div> -->
            </div>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Техническое обслуживание</h1>
            <p class="text-gray-600 text-sm">Система временно недоступна. Мы работаем над улучшением сервиса.</p>
        </div>

        <!-- Timer Card -->
        <div class="timer-card rounded-2xl p-6 mb-6 text-white">
            <div class="text-center">
                <h2 class="text-lg font-semibold mb-4">Ожидаемое время завершения</h2>
                
                <!-- Circular Progress Timer -->
                <div class="relative w-32 h-32 mx-auto mb-4">
                    <svg class="w-32 h-32 progress-ring" viewBox="0 0 120 120">
                        <!-- Background circle -->
                        <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="8"/>
                        <!-- Progress circle -->
                        <circle cx="60" cy="60" r="54" fill="none" stroke="white" stroke-width="8" 
                                stroke-dasharray="339.292" 
                                :stroke-dashoffset="339.292 - (339.292 * progressPercent / 100)"
                                class="progress-ring-circle"/>
                    </svg>
                    
                    <!-- Timer Display -->
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <div class="text-2xl font-bold" x-text="timeLeft.hours.toString().padStart(2, '0')"></div>
                        <div class="text-xs opacity-80">часов</div>
                    </div>
                </div>
                
                <!-- Time Details -->
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold" x-text="timeLeft.minutes.toString().padStart(2, '0')"></div>
                        <div class="text-xs opacity-80">минут</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" x-text="timeLeft.seconds.toString().padStart(2, '0')"></div>
                        <div class="text-xs opacity-80">секунд</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" x-text="Math.round(progressPercent)"></div>
                        <div class="text-xs opacity-80">% готово</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Maintenance Info -->
        <div class="maintenance-card rounded-2xl p-6 mb-6 border border-gray-200">
            <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0">
                    <i data-lucide="info" class="w-6 h-6 text-blue-600"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Что происходит?</h3>
                    <p class="text-gray-600 text-sm leading-relaxed">
                        Мы проводим плановое техническое обслуживание системы для улучшения производительности и безопасности. 
                        Все данные сохранены и будут доступны после завершения работ.
                    </p>
                </div>
            </div>
        </div>

        <!-- Progress Updates -->
        <div class="maintenance-card rounded-2xl p-6 mb-6 border border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">Ход выполнения</h3>
            <div class="space-y-4">
                <template x-for="(update, index) in progressUpdates" :key="index">
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0"
                             :class="update.completed ? 'bg-green-100' : 'bg-gray-100'">
                            <template x-if="update.completed">
                                <i data-lucide="check" class="w-4 h-4 text-green-600"></i>
                            </template>
                            <template x-if="!update.completed">
                                <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                            </template>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-900" x-text="update.title"></div>
                            <div class="text-xs text-gray-500" x-text="update.description"></div>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Contact Info -->
        <div class="maintenance-card rounded-2xl p-6 mb-6 border border-gray-200">
            <div class="flex items-start space-x-4">
                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center flex-shrink-0">
                    <i data-lucide="phone" class="w-6 h-6 text-green-600"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Нужна помощь?</h3>
                    <p class="text-gray-600 text-sm mb-3">
                        Если у вас есть срочные вопросы, свяжитесь с нашей технической поддержкой.
                    </p>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <i data-lucide="mail" class="w-4 h-4 text-gray-400"></i>
                            <span class="text-sm text-gray-600">support@smartfactory.com</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <i data-lucide="phone" class="w-4 h-4 text-gray-400"></i>
                            <span class="text-sm text-gray-600">+7 (999) 123-45-67</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auto Refresh Status -->
        <div class="maintenance-card rounded-2xl p-4 border border-gray-200">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i data-lucide="refresh-cw" class="w-4 h-4 text-blue-600" :class="{'animate-spin': autoRefresh}"></i>
                    </div>
                    <div>
                        <div class="text-sm font-medium text-gray-900">Автообновление</div>
                        <div class="text-xs text-gray-500" x-text="autoRefresh ? 'Включено' : 'Выключено'"></div>
                    </div>
                </div>
                <button @click="toggleAutoRefresh" 
                        class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                        :class="autoRefresh ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-700'">
                    <span x-text="autoRefresh ? 'Выключить' : 'Включить'"></span>
                </button>
            </div>
        </div>

        <!-- Manual Refresh Button -->
        <div class="mt-6 mb-8">
            <button @click="checkSystemStatus" 
                    class="w-full py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                <i data-lucide="refresh-cw" class="w-5 h-5" :class="{'animate-spin': checkingStatus}"></i>
                <span x-text="checkingStatus ? 'Проверка...' : 'Проверить статус системы'"></span>
            </button>
        </div>
    </main>

    <!-- Toast Notification -->
    <div x-show="toast.show"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed bottom-20 left-1/2 transform -translate-x-1/2 z-50 bg-white border border-gray-200 shadow-lg rounded-xl px-4 py-3 flex items-center space-x-3 text-sm font-medium text-gray-800 max-w-sm mx-4"
         x-cloak>
        <template x-if="toast.type === 'success'">
            <i data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
        </template>
        <template x-if="toast.type === 'error'">
            <i data-lucide="alert-circle" class="w-5 h-5 text-red-500"></i>
        </template>
        <template x-if="toast.type === 'info'">
            <i data-lucide="info" class="w-5 h-5 text-blue-500"></i>
        </template>
        <span x-text="toast.message"></span>
    </div>
</div>

<script>
    function maintenancePage() {
        return {
            // Timer state
            endTime: null,
            timeLeft: { hours: 0, minutes: 0, seconds: 0 },
            progressPercent: 0,
            totalDuration: 0,
            
            // UI state
            autoRefresh: true,
            checkingStatus: false,
            toast: { show: false, message: '', type: 'info', timeout: null },
            
            // Progress updates
            progressUpdates: [
                { title: 'Анализ системы', description: 'Проверка целостности данных', completed: true },
                { title: 'Обновление модулей', description: 'Установка новых компонентов', completed: true },
                { title: 'Оптимизация базы данных', description: 'Улучшение производительности', completed: false },
                { title: 'Тестирование функций', description: 'Проверка работоспособности', completed: false },
                { title: 'Завершение работ', description: 'Финальная проверка системы', completed: false }
            ],
            
            init() {
                // Set maintenance end time (2 hours from now)
                this.endTime = new Date(Date.now() + 2 * 60 * 60 * 1000);
                this.totalDuration = 2 * 60 * 60 * 1000; // 2 hours in milliseconds
                
                this.updateTimer();
                this.startTimer();
                this.startAutoRefresh();
                lucide.createIcons();
            },
            
            startTimer() {
                setInterval(() => {
                    this.updateTimer();
                }, 1000);
            },
            
            updateTimer() {
                const now = new Date().getTime();
                const distance = this.endTime.getTime() - now;
                
                if (distance < 0) {
                    // Maintenance completed
                    this.timeLeft = { hours: 0, minutes: 0, seconds: 0 };
                    this.progressPercent = 100;
                    this.showToast('Техническое обслуживание завершено!', 'success');
                    this.checkSystemStatus();
                    return;
                }
                
                // Calculate time left
                const hours = Math.floor(distance / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                this.timeLeft = { hours, minutes, seconds };
                
                // Calculate progress
                const elapsed = this.totalDuration - distance;
                this.progressPercent = Math.min(100, (elapsed / this.totalDuration) * 100);
                
                // Update progress updates based on progress
                this.updateProgressUpdates();
            },
            
            updateProgressUpdates() {
                const progress = this.progressPercent;
                
                this.progressUpdates = [
                    { title: 'Анализ системы', description: 'Проверка целостности данных', completed: progress >= 10 },
                    { title: 'Обновление модулей', description: 'Установка новых компонентов', completed: progress >= 30 },
                    { title: 'Оптимизация базы данных', description: 'Улучшение производительности', completed: progress >= 60 },
                    { title: 'Тестирование функций', description: 'Проверка работоспособности', completed: progress >= 80 },
                    { title: 'Завершение работ', description: 'Финальная проверка системы', completed: progress >= 95 }
                ];
            },
            
            startAutoRefresh() {
                if (this.autoRefresh) {
                    this.autoRefreshInterval = setInterval(() => {
                        this.checkSystemStatus(true); // Silent check
                    }, 30000); // Check every 30 seconds
                }
            },
            
            stopAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                    this.autoRefreshInterval = null;
                }
            },
            
            toggleAutoRefresh() {
                this.autoRefresh = !this.autoRefresh;
                if (this.autoRefresh) {
                    this.startAutoRefresh();
                    this.showToast('Автообновление включено', 'info');
                } else {
                    this.stopAutoRefresh();
                    this.showToast('Автообновление выключено', 'info');
                }
            },
            
            async checkSystemStatus(silent = false) {
                if (this.checkingStatus) return;
                
                this.checkingStatus = true;
                
                try {
                    // Simulate API call to check system status
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // Simulate random system status
                    const isOnline = Math.random() > 0.7; // 30% chance system is back online
                    
                    if (isOnline) {
                        this.showToast('Система снова доступна! Перенаправление...', 'success');
                        setTimeout(() => {
                            window.location.href = '/dashboard/';
                        }, 2000);
                    } else {
                        if (!silent) {
                            this.showToast('Система все еще недоступна', 'info');
                        }
                    }
                } catch (error) {
                    if (!silent) {
                        this.showToast('Ошибка при проверке статуса', 'error');
                    }
                } finally {
                    this.checkingStatus = false;
                }
            },
            
            showToast(message, type = 'info') {
                this.toast.message = message;
                this.toast.type = type;
                this.toast.show = true;
                lucide.createIcons();
                
                if (this.toast.timeout) {
                    clearTimeout(this.toast.timeout);
                }
                
                this.toast.timeout = setTimeout(() => {
                    this.toast.show = false;
                }, 3000);
            }
        }
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() { 
        lucide.createIcons(); 
    });
</script>
</body>
</html> 