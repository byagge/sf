{% extends 'finance/base.html' %}

{% block title %}Долг: {{ debt.title }} - Финансовая система{% endblock %}

{% block content %}
<div class="space-y-6">
	<div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
		<div class="flex items-center justify-between">
			<div>
				<h1 class="text-2xl font-semibold text-gray-900">{{ debt.title }}</h1>
				<p class="text-gray-600">{% if debt.direction == 'payable' %}Мы должны{% else %}Нам должны{% endif %}{% if debt.supplier %} — {{ debt.supplier.name }}{% elif debt.counterparty_name %} — {{ debt.counterparty_name }}{% endif %}</p>
			</div>
			<div class="text-right">
				<div class="text-sm text-gray-500">Создан: {{ debt.created_at|date:"d.m.Y H:i" }}</div>
				{% if debt.due_date %}<div class="text-sm">Срок: <span class="font-medium">{{ debt.due_date|date:"d.m.Y" }}</span></div>{% endif %}
			</div>
		</div>
		<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
			<div class="bg-gray-50 rounded-lg p-4">
				<div class="text-sm text-gray-600">Сумма долга</div>
				<div class="text-xl font-semibold">{{ debt.original_amount }}</div>
			</div>
			<div class="bg-gray-50 rounded-lg p-4">
				<div class="text-sm text-gray-600">Оплачено</div>
				<div class="text-xl font-semibold text-green-600">{{ debt.amount_paid }}</div>
			</div>
			<div class="bg-gray-50 rounded-lg p-4">
				<div class="text-sm text-gray-600">Остаток</div>
				<div class="text-xl font-semibold {% if debt.outstanding_amount > 0 %}text-red-600{% endif %}">{{ debt.outstanding_amount }}</div>
			</div>
		</div>
		{% if debt.description %}
		<div class="mt-4 text-gray-700">{{ debt.description }}</div>
		{% endif %}
	</div>

	<div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
		<div class="flex items-center justify-between mb-4">
			<h2 class="text-lg font-semibold">Оплаты</h2>
			<form action="{% url 'finance:debt_add_payment' debt.pk %}" method="post" class="flex items-end gap-2">
				{% csrf_token %}
				<div>
					<label class="form-label">Сумма</label>
					{{ payment_form.amount }}
				</div>
				<div>
					<label class="form-label">Дата</label>
					{{ payment_form.date }}
				</div>
				<div class="w-64">
					<label class="form-label">Комментарий</label>
					{{ payment_form.comment }}
				</div>
				<button type="submit" class="btn btn-primary"><i data-lucide="plus" class="w-4 h-4 mr-1"></i>Добавить</button>
			</form>
		</div>
		{% if payments %}
		<div class="table-responsive">
			<table class="table">
				<thead>
					<tr>
						<th>Дата</th>
						<th>Сумма</th>
						<th>Комментарий</th>
						<th>Создал</th>
					</tr>
				</thead>
				<tbody>
					{% for p in payments %}
					<tr>
						<td>{{ p.date|date:"d.m.Y" }}</td>
						<td class="text-green-700">{{ p.amount }}</td>
						<td>{{ p.comment|default:'-' }}</td>
						<td>{{ p.created_by }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
		{% else %}
		<div class="text-gray-500">Пока нет оплат</div>
		{% endif %}
	</div>
</div>
{% endblock %} 