{% extends 'finance/base.html' %}

{% block title %}{% if form.instance.pk %}Редактирование имущества{% else %}Новое имущество{% endif %} - Финансовая система{% endblock %}

{% block content %}
<!-- Header -->
<div class="flex justify-between items-center mb-8">
    <div>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            {% if form.instance.pk %}Редактирование имущества{% else %}Новое имущество{% endif %}
        </h1>
        <p class="text-gray-600">
            {% if form.instance.pk %}
                Измените информацию об имуществе
            {% else %}
                Добавьте новое имущество в активы предприятия
            {% endif %}
        </p>
    </div>
    <a href="{% url 'finance:factory_assets' %}" class="btn btn-secondary flex items-center space-x-2">
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        <span>Назад к имуществу</span>
    </a>
</div>

<!-- Форма имущества -->
<div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
        <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <i data-lucide="building" class="w-5 h-5 mr-2 text-blue-600"></i>
            {% if form.instance.pk %}Редактирование имущества{% else %}Создание имущества{% endif %}
        </h3>
    </div>
    
    <form method="post" class="p-6 space-y-6">
        {% csrf_token %}
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Название -->
            <div class="form-group">
                <label for="{{ form.name.id_for_label }}" class="form-label">
                    Название имущества *
                </label>
                {{ form.name }}
                {% if form.name.errors %}
                    <p class="errorlist">{{ form.name.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Тип имущества -->
            <div class="form-group">
                <label for="{{ form.asset_type.id_for_label }}" class="form-label">
                    Тип имущества *
                </label>
                {{ form.asset_type }}
                {% if form.asset_type.errors %}
                    <p class="errorlist">{{ form.asset_type.errors.0 }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Цена покупки -->
            <div class="form-group">
                <label for="{{ form.purchase_price.id_for_label }}" class="form-label">
                    Цена покупки (сом) *
                </label>
                {{ form.purchase_price }}
                {% if form.purchase_price.errors %}
                    <p class="errorlist">{{ form.purchase_price.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Текущая стоимость -->
            <div class="form-group">
                <label for="{{ form.current_value.id_for_label }}" class="form-label">
                    Текущая стоимость (сом) *
                </label>
                {{ form.current_value }}
                {% if form.current_value.errors %}
                    <p class="errorlist">{{ form.current_value.errors.0 }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Дата покупки -->
            <div class="form-group">
                <label for="{{ form.purchase_date.id_for_label }}" class="form-label">
                    Дата покупки *
                </label>
                {{ form.purchase_date }}
                {% if form.purchase_date.errors %}
                    <p class="errorlist">{{ form.purchase_date.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Поставщик -->
            <div class="form-group">
                <label for="{{ form.supplier.id_for_label }}" class="form-label">
                    Поставщик
                </label>
                {{ form.supplier }}
                {% if form.supplier.errors %}
                    <p class="errorlist">{{ form.supplier.errors.0 }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Местоположение -->
            <div class="form-group">
                <label for="{{ form.location.id_for_label }}" class="form-label">
                    Местоположение
                </label>
                {{ form.location }}
                {% if form.location.errors %}
                    <p class="errorlist">{{ form.location.errors.0 }}</p>
                {% endif %}
            </div>
            
            <!-- Дата окончания гарантии -->
            <div class="form-group">
                <label for="{{ form.warranty_expiry.id_for_label }}" class="form-label">
                    Дата окончания гарантии
                </label>
                {{ form.warranty_expiry }}
                {% if form.warranty_expiry.errors %}
                    <p class="errorlist">{{ form.warranty_expiry.errors.0 }}</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Описание -->
        <div class="form-group">
            <label for="{{ form.description.id_for_label }}" class="form-label">
                Описание
            </label>
            {{ form.description }}
            <p class="form-help">Подробное описание имущества</p>
            {% if form.description.errors %}
                <p class="errorlist">{{ form.description.errors.0 }}</p>
            {% endif %}
        </div>
        
        <!-- Кнопки -->
        <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
            <a href="{% url 'finance:factory_assets' %}" class="btn btn-secondary">
                Отмена
            </a>
            <button type="submit" class="btn btn-primary">
                {% if form.instance.pk %}Сохранить изменения{% else %}Создать имущество{% endif %}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const purchasePriceField = document.getElementById('{{ form.purchase_price.id_for_label }}');
    const currentValueField = document.getElementById('{{ form.current_value.id_for_label }}');
    const purchaseDateField = document.getElementById('{{ form.purchase_date.id_for_label }}');
    
    // Устанавливаем текущую дату для новых активов
    if (purchaseDateField && !purchaseDateField.value) {
        const today = new Date().toISOString().split('T')[0];
        purchaseDateField.value = today;
    }
    
    // Автоматически устанавливаем текущую стоимость равной цене покупки
    if (purchasePriceField && currentValueField) {
        purchasePriceField.addEventListener('input', function() {
            if (!currentValueField.value) {
                currentValueField.value = this.value;
            }
        });
    }
    
    // Валидация цен
    [purchasePriceField, currentValueField].forEach(field => {
        if (field) {
            field.addEventListener('input', function() {
                const value = parseFloat(this.value);
                if (value < 0) {
                    this.setCustomValidity('Цена не может быть отрицательной');
                } else {
                    this.setCustomValidity('');
                }
            });
        }
    });
});
</script>
{% endblock %} 