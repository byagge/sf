# Приложение поддержки с ИИ

Приложение поддержки для Smart Factory с интеграцией искусственного интеллекта для автоматических ответов пользователям.

## Возможности

- **Чат поддержки**: Пользователи могут создавать чаты и получать помощь
- **ИИ помощник**: Автоматические ответы на вопросы пользователей через OpenAI API
- **Админ панель**: Управление тикетами, чатами и настройками ИИ
- **API**: REST API для интеграции с другими системами

## Модели данных

### SupportChat
- Основная модель чата поддержки
- Связь с пользователем
- Название и статус активности

### ChatMessage
- Сообщения в чате
- Типы: пользователь, ИИ, администратор
- Временные метки

### AIUserSettings
- Настройки ИИ для каждого пользователя
- Возможность включения/отключения ИИ
- Настройки модели и параметров

### SupportTicket
- Тикеты для администраторов
- Приоритеты и статусы
- Назначение на администраторов

### SupportCategory
- Категории обращений в поддержку

## Настройка

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка OpenAI API

Добавьте в `settings.py`:

```python
OPENAI_API_KEY = 'your-openai-api-key-here'
```

### 3. Миграции

```bash
python manage.py makemigrations support
python manage.py migrate
```

### 4. Создание суперпользователя (если нужно)

```bash
python manage.py createsuperuser
```

## Использование

### Для пользователей

1. **Создание чата**: Перейдите в раздел поддержки и создайте новый чат
2. **Отправка сообщений**: Напишите ваш вопрос, ИИ автоматически ответит
3. **Просмотр истории**: Все сообщения сохраняются в чате

### Для администраторов

1. **Дашборд**: Просмотр всех тикетов и статистики
2. **Управление чатами**: Просмотр и ответы в чатах пользователей
3. **Управление ИИ**: Включение/отключение ИИ для пользователей
4. **Управление тикетами**: Изменение статусов, приоритетов и назначений

## API Endpoints

### Пользователи
- `GET /support/api/chats/` - список чатов пользователя
- `POST /support/api/chats/` - создание нового чата
- `GET /support/api/chats/{id}/` - информация о чате
- `POST /support/api/chats/{id}/` - отправка сообщения
- `GET /support/api/ai/status/` - статус ИИ

### Администраторы
- `POST /support/api/admin/ai/toggle/{user_id}/` - переключение ИИ
- `POST /support/api/admin/chat/{chat_id}/message/` - отправка сообщения от админа

## Настройки ИИ

### Системный промпт
ИИ настроен как помощник службы поддержки умной фабрики с задачами:
- Помощь в работе с системой
- Ответы на вопросы пользователей
- Предложение обратиться к администратору при сложных вопросах

### Параметры по умолчанию
- Модель: `gpt-3.5-turbo`
- Максимум токенов: 1000
- Температура: 0.7

## Безопасность

- Все API endpoints требуют аутентификации
- Административные функции доступны только для staff пользователей
- CSRF защита для всех форм
- Валидация входных данных

## Мониторинг

- Логирование всех операций с ИИ
- Отслеживание ошибок API
- Статистика использования

## Расширение

### Добавление новых моделей ИИ
1. Создайте новый класс в `ai_service.py`
2. Реализуйте методы `generate_response` и `is_available`
3. Обновите `AISupportService` для использования новой модели

### Кастомные промпты
Измените системный промпт в методе `_get_chat_context` для адаптации под ваши нужды.

### Интеграция с другими системами
Используйте API endpoints для интеграции с внешними системами поддержки.

## Troubleshooting

### ИИ не отвечает
1. Проверьте API ключ OpenAI
2. Убедитесь, что ИИ включен для пользователя
3. Проверьте логи на наличие ошибок

### Ошибки миграций
1. Убедитесь, что все зависимости установлены
2. Проверьте совместимость версий Django
3. Удалите миграции и создайте заново при необходимости

## Лицензия

Внутреннее использование для Smart Factory. 